<!DOCTYPE html>
<html lang="en">
<head>
  <title>Bootstrap Example</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet"  href="lib/bootstrap.min.css">
  <link rel="stylesheet"  type="text/css"  href="bootstrap-3.3.2-dist/css/bootstrap.min.css">
  
  
       <script src="lib/json2.js"></script>   
	 <script type="text/javascript" src="lib/underscore.js"></script>              
        <script type="text/javascript" src="lib/backbone-0.9.2.js"></script> 
 <script src="lib/jquery-2.1.3.min.js"></script>
<script src="lib/jquery-1.9.1.js"></script> 
  <script src="bootstrap-3.3.2-dist/js/bootstrap.min.js"></script>
  <script type="text/javascript" src="lib/backbone-0.9.2.js"></script> 
<script type='text/javascript'>

var categoryList = [
        {
            "category": "בטחון פנים",
            "id": 115
        }, 
        {
            "category": "כלכלה",
            "id": [92,113,101]
        }, 
		 {
            "category": "הגירה וגבולות",
            "id": [108,107]
        }, 
		 {
            "category": "שקיפות",
            "id": 99
        }, 		 
		 {
            "category": "תחבורה ציבורית",
            "id": 102
        }, 
		 {
            "category": "זכויות",
            "id": 104
        }, 		 
		 {
            "category": "זכויות אדם",
            "id": 105
        }, 
		 {
            "category": "מגדר",
            "id": [106]
        }, 
		 {
            "category": "חינוך",
            "id": 109
        }, 		
		 {
            "category": "איכות הסביבה",
            "id": 114
        }, 		
        {
             "category": "זכויות בעלי חיים",
            "id": 93
        }
    ];

// http://stackoverflow.com/questions/901115/how-can-i-get-query-string-values-in-javascript
function getParameterByName(name) {
    name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
    var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
        results = regex.exec(location.search);
    return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
}
$(window).load(function(){
	var items = {};       	         
        //$.ajax({url: "http://localhost:4502/Services/agenda.jsonp?jsoncallback=?", async: false, dataType: "jsonp", success: function(json) {console.log(1);items = json;}, error: function(err) {console.log(err);}});       	   
$.ajax({url: "https://oknesset.org/api/v2/agenda/", async: false, dataType: "json", success: function(json) {items = json.objects;}, error: function(err) {console.log(err);}});
// filter the relevants agendas by the category
var categoryDesc = getParameterByName('categoryDesc');

var categoryIds = _.where(categoryList, {category: categoryDesc});
var agenda4category = {};
_.each(categoryIds[0].id, function(id){agenda4category = _.union(agenda4category,_.where(items, {id: id})); });
agenda4category = _.filter(agenda4category, function(a){ return a.id > 0; });
// Render the template with the items data and insert
// the rendered HTML before the "p" in the "div.row" element
var divTemplate = $("#div-data").html();
$("div.row p").before(_.template(divTemplate,{items:agenda4category}));

});
</script>

</head>
<body>

<div class="container-fluid">
  <div class="row">
    
    
<p>&nbsp;</p>
	<div class="col-xs-12" style="background-color:lavenderblush;">
		<button type="button" class="btn btn-default" style="width:50px;height:50px;margin:2px;" ><span class="glyphicon glyphicon-search small"><h6 >לנושא הבא</h6></span></button><button type="button" class="btn btn-primary" style="width:50px;height:50px;margin:2px;" ><span class="glyphicon glyphicon-search small"><h6 >לתוצאות</h6></span></button></div>
</div>

<script type="text/html" id='div-data'>    
     <% _.each(items,function(item,key,list){ %>
	 <div class="col-xs-12" style="background-color:lavender;"><h3 align="center" ><%= item.name %></h3></div>	
	 <div class="col-xs-12" style="background-color:lavender;"><h4 align="center" ><%= item.public_owner_name %></h4></div>	
	 <div class="col-xs-12" style="background-color:lavender;"><h5 align="center" ><%= item.description %></h5></div>	
  </div>
	<div class="col-xs-12" style="background-color:lavenderblush;">
		<button type="button" class="btn btn-danger" style="width:50px;height:50px;margin:2px;" ><span class="glyphicon glyphicon-search small"><h6 >לא מסכים/ה</h6></span></button>
		<button type="button" class="btn btn-default" style="width:50px;height:50px;margin:2px;" ><span class="glyphicon glyphicon-search small"><h6 >נמנע/ה</h6></span></button>		
		<button type="button" class="btn btn-success" style="width:50px;height:50px;margin:2px;" ><span class="glyphicon glyphicon-search small"><h6 >מסכים/ה</h6></span></button>
	</div>
    <% }) %>
</script>

</body>
</html>
